"use strict";(self["webpackChunkvue_live_week7"]=self["webpackChunkvue_live_week7"]||[]).push([[277],{2885:function(t,e,o){o.d(e,{Z:function(){return D}});var n=o(6252),a=o(3577);const s={id:"deleteModal",ref:"deleteModal",class:"modal fade",tabindex:"-1"},l={class:"modal-dialog"},i={class:"modal-content border-0"},d=(0,n._)("div",{class:"modal-header bg-danger text-white"},[(0,n._)("h5",{id:"deleteModalLabel",class:"modal-title"},[(0,n._)("span",null,"刪除後將無法恢復")]),(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),u={key:0,class:"modal-body"},p=(0,n.Uk)(" 是否確認刪除 "),c={class:"text-danger"},m=(0,n.Uk)(" ? "),r={key:1,class:"modal-body"},h=(0,n.Uk)(" 是否確認刪除 訂單編號 "),b={class:"text-danger"},g=(0,n.Uk)(" ? "),_={class:"modal-footer"},C=(0,n._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function v(t,e,o,v,y,f){return(0,n.wg)(),(0,n.iD)("div",s,[(0,n._)("div",l,[(0,n._)("div",i,[d,o.item.title?((0,n.wg)(),(0,n.iD)("div",u,[p,(0,n._)("strong",c,(0,a.zw)(o.item.title),1),m])):((0,n.wg)(),(0,n.iD)("div",r,[h,(0,n._)("strong",b,(0,a.zw)(o.item.id),1),g])),(0,n._)("div",_,[C,(0,n._)("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:e[0]||(e[0]=e=>t.$emit("delete-item"))}," 確認刪除 ")])])])],512)}var y=o(7424),f=o.n(y),w={name:"DeleteModal",props:["item"],emits:["delete-item"],data(){return{modal:{}}},mounted(){this.modal=new(f())(this.$refs.deleteModal)}},k=o(3744);const M=(0,k.Z)(w,[["render",v]]);var D=M},1277:function(t,e,o){o.r(e),o.d(e,{default:function(){return F}});var n=o(6252),a=o(3577);const s={class:"container my-5"},l=(0,n._)("h1",null,"優惠券管理",-1),i={class:"text-end mt-3"},d={class:"table mt-4"},u=(0,n._)("thead",null,[(0,n._)("tr",null,[(0,n._)("th",null,"名稱"),(0,n._)("th",null,"折扣百分比"),(0,n._)("th",null,"到期日"),(0,n._)("th",null,"是否啟用"),(0,n._)("th",null,"編輯")])],-1),p={key:0,class:"text-success"},c={key:1,class:"text-muted"},m={class:"btn-group"},r=["onClick"],h=["onClick"];function b(t,e,o,b,g,_){const C=(0,n.up)("Loading-component"),v=(0,n.up)("coupon-modal"),y=(0,n.up)("delete-modal"),f=(0,n.up)("pagination-component");return(0,n.wg)(),(0,n.iD)("div",s,[(0,n.Wm)(C,{active:g.isLoading},null,8,["active"]),l,(0,n.Wm)(v,{coupon:g.tempCoupon,"current-page":g.currentPage,ref:"CouponModal",onGetCoupons:_.getCoupons},null,8,["coupon","current-page","onGetCoupons"]),(0,n.Wm)(y,{item:g.tempCoupon,ref:"deleteModal",onDeleteItem:_.deleteCoupon},null,8,["item","onDeleteItem"]),(0,n._)("div",i,[(0,n._)("button",{class:"btn btn-primary",type:"button","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:e[0]||(e[0]=t=>g.tempCoupon={due_date:(new Date).getTime()/1e3,is_enabled:0})}," 建立新的優惠券 ")]),(0,n._)("table",d,[u,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(g.coupons,((e,o)=>((0,n.wg)(),(0,n.iD)("tr",{key:o},[(0,n._)("td",null,(0,a.zw)(e.title),1),(0,n._)("td",null,(0,a.zw)(e.percent)+"%",1),(0,n._)("td",null,(0,a.zw)(t.$filters.date(e.due_date)),1),(0,n._)("td",null,[1===e.is_enabled?((0,n.wg)(),(0,n.iD)("span",p,"啟用")):((0,n.wg)(),(0,n.iD)("span",c,"未啟用"))]),(0,n._)("td",null,[(0,n._)("div",m,[(0,n._)("button",{type:"button",class:"btn btn-outline-primary btn-sm","data-bs-toggle":"modal","data-bs-target":"#couponModal",onClick:t=>_.openCouponModal(e)}," 編輯 ",8,r),(0,n._)("button",{type:"button",class:"btn btn-outline-danger btn-sm","data-bs-toggle":"modal","data-bs-target":"#deleteModal",onClick:t=>_.openDeleteModal(e)}," 刪除 ",8,h)])])])))),128))])]),(0,n.Wm)(f,{pages:g.pagination,onGetItems:_.getCoupons},null,8,["pages","onGetItems"])])}var g=o(9963);const _={class:"modal fade",id:"couponModal",tabindex:"-1",ref:"couponModal"},C={class:"modal-dialog",role:"document"},v={class:"modal-content"},y={class:"modal-header"},f={class:"modal-title",id:"exampleModalLabel"},w={key:0},k={key:1},M=(0,n._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),D={class:"modal-body"},$={class:"mb-3"},x=(0,n._)("label",{for:"title"},"標題",-1),L={class:"mb-3"},S=(0,n._)("label",{for:"coupon_code"},"優惠碼",-1),U={class:"mb-3"},P=(0,n._)("label",{for:"due_date"},"到期日",-1),Z={class:"mb-3"},z=(0,n._)("label",{for:"price"},"折扣百分比",-1),I={class:"mb-3"},V={class:"form-check"},G=(0,n._)("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),W={class:"modal-footer"},O=(0,n._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function J(t,e,o,a,s,l){return(0,n.wg)(),(0,n.iD)("div",_,[(0,n._)("div",C,[(0,n._)("div",v,[(0,n._)("div",y,[(0,n._)("h5",f,[s.tempCoupon.id?((0,n.wg)(),(0,n.iD)("span",w,"編輯優惠券")):((0,n.wg)(),(0,n.iD)("span",k,"新增優惠券"))]),M]),(0,n._)("div",D,[(0,n._)("div",$,[x,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=t=>s.tempCoupon.title=t),placeholder:"請輸入標題"},null,512),[[g.nr,s.tempCoupon.title]])]),(0,n._)("div",L,[S,(0,n.wy)((0,n._)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=t=>s.tempCoupon.code=t),placeholder:"請輸入優惠碼"},null,512),[[g.nr,s.tempCoupon.code]])]),(0,n._)("div",U,[P,(0,n.wy)((0,n._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=t=>s.due_date=t)},null,512),[[g.nr,s.due_date]])]),(0,n._)("div",Z,[z,(0,n.wy)((0,n._)("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":e[3]||(e[3]=t=>s.tempCoupon.percent=t),placeholder:"請輸入折扣百分比"},null,512),[[g.nr,s.tempCoupon.percent,void 0,{number:!0}]])]),(0,n._)("div",I,[(0,n._)("div",V,[(0,n.wy)((0,n._)("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=t=>s.tempCoupon.is_enabled=t)},null,512),[[g.e8,s.tempCoupon.is_enabled]]),G])])]),(0,n._)("div",W,[O,s.tempCoupon.id?((0,n.wg)(),(0,n.iD)("button",{key:0,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[5]||(e[5]=(...t)=>l.editCoupon&&l.editCoupon(...t))}," 確認編輯 ")):((0,n.wg)(),(0,n.iD)("button",{key:1,type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[6]||(e[6]=(...t)=>l.addCoupon&&l.addCoupon(...t))}," 確認新增 "))])])])],512)}var N=o(7424),T=o.n(N),H={name:"CouponModal",emits:["get-coupons"],props:{coupon:{}},data(){return{modal:{},tempCoupon:{},due_date:""}},watch:{coupon(){this.tempCoupon=this.coupon;const t=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=t},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},methods:{addCoupon(){this.$http.post("https://vue3-course-api.hexschool.io/v2/api/yclu/admin/coupon",{data:this.tempCoupon}).then((t=>{this.$httpMessageState(t,"新增優惠券"),this.$emit("get-coupons",this.currentPage)})).catch((t=>{this.$httpMessageState(t.response,"錯誤訊息")}))},editCoupon(){this.$http.put(`https://vue3-course-api.hexschool.io/v2/api/yclu/admin/coupon/${this.tempCoupon.id}`,{data:this.tempCoupon}).then((t=>{this.$httpMessageState(t,"編輯優惠券"),this.$emit("get-coupons",this.currentPage)})).catch((t=>{this.$httpMessageState(t.response,"錯誤訊息")}))}},mounted(){this.modal=new(T())(this.$refs.couponModal)}},K=o(3744);const Y=(0,K.Z)(H,[["render",J]]);var j=Y,q=o(2885),A=o(2148),B={data(){return{coupons:[],tempCoupon:{},pagination:{},currentPage:1,isLoading:!1}},components:{PaginationComponent:A.Z,CouponModal:j,DeleteModal:q.Z},methods:{getCoupons(t=1){this.isLoading=!0,this.currentPage=t,this.$http.get(`https://vue3-course-api.hexschool.io/v2/api/yclu/admin/coupons/?page=${t}`).then((t=>{this.coupons=t.data.coupons,this.pagination=t.data.pagination,this.isLoading=!1})).catch((t=>{this.$httpMessageState(t.response,"錯誤訊息"),this.isLoading=!1}))},openCouponModal(t){this.isLoading=!0,this.tempCoupon=JSON.parse(JSON.stringify(t)),this.isLoading=!1},openDeleteModal(t){this.isLoading=!0,this.tempCoupon=t,this.isLoading=!1},deleteCoupon(){this.isLoading=!0,this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/yclu/admin/coupon/${this.tempCoupon.id}`).then((t=>{this.$httpMessageState(t,"刪除優惠券"),this.getCoupons(),this.isLoading=!1})).catch((t=>{this.$httpMessageState(t.response,"刪除優惠券"),this.isLoading=!1}))}},mounted(){this.getCoupons()}};const E=(0,K.Z)(B,[["render",b]]);var F=E}}]);
//# sourceMappingURL=277.092f7531.js.map