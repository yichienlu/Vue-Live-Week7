"use strict";(self["webpackChunkvue_live_week7"]=self["webpackChunkvue_live_week7"]||[]).push([[732],{2732:function(t,e,s){s.r(e),s.d(e,{default:function(){return X}});var a=s(6252),l=s(3577),o=s(9963);const i={class:"container py-5"},n=(0,a._)("h1",{class:"text-center"},"購物車",-1),r={key:0,class:"my-5 text-center"},c=(0,a.Uk)(" 購物車裡沒有東西！快去逛逛吧！！ "),d={key:1},u={class:"text-end"},m=["disabled"],p={class:"table align-middle"},h=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"品名"),(0,a._)("th",{class:"text-center"},"單價"),(0,a._)("th",{style:{width:"150px"}},"數量"),(0,a._)("th",{class:"text-end"},"合計")])],-1),g=["src","alt"],_={class:"text-center"},b={key:0},v={key:1},f={class:"input-group mb-3"},C=["onClick"],y=["onUpdate:modelValue","onChange"],k=["onClick"],w=["onClick","disabled"],x={class:"text-end"},$=(0,a._)("td",{colspan:"3",class:"text-end"},"總計",-1),L={class:"text-end"},D=(0,a._)("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),I={class:"text-end text-success"},V=(0,a._)("br",null,null,-1),S={key:0,class:"text-mute"},M={class:"input-group mb-3 input-group-sm"},W={class:"input-group-append"},q={class:"my-5"},U=(0,a._)("h3",{class:"text-center mb-3"},"訂購人資訊",-1),z={class:"row justify-content-center"},O={class:"mb-3"},j=(0,a._)("label",{for:"email",class:"form-label"},"Email",-1),E={class:"mb-3"},P=(0,a._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),T={class:"mb-3"},Z=(0,a._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),F={class:"mb-3"},H=(0,a._)("label",{for:"address",class:"form-label"},"收件人地址",-1),K={class:"mb-3"},Y=(0,a._)("label",{for:"message",class:"form-label"},"留言",-1),A={class:"text-end"},B=["disabled"];function G(t,e,s,G,J,N){const Q=(0,a.up)("loading-component"),R=(0,a.up)("router-link"),X=(0,a.up)("field-component"),tt=(0,a.up)("error-message"),et=(0,a.up)("form-component");return(0,a.wg)(),(0,a.iD)("div",i,[(0,a.Wm)(Q,{active:J.isLoading},null,8,["active"]),n,0==J.cartData.carts.length?((0,a.wg)(),(0,a.iD)("div",r,[(0,a.Wm)(R,{to:"/products"},{default:(0,a.w5)((()=>[c])),_:1})])):((0,a.wg)(),(0,a.iD)("div",d,[(0,a._)("div",u,[(0,a._)("button",{class:"btn btn-outline-danger",type:"button",disabled:0===J.cartData.carts.length,onClick:e[0]||(e[0]=(...t)=>N.clearCart&&N.clearCart(...t))}," 清空購物車 ",8,m)]),(0,a._)("table",p,[h,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(J.cartData.carts,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,[(0,a.Wm)(R,{to:`/product/${t.product.id}`,class:"link-dark text-decoration-none d-flex align-items-center"},{default:(0,a.w5)((()=>[(0,a._)("img",{src:t.product.imageUrl,alt:t.product.title,height:"100",class:"mx-3"},null,8,g),(0,a._)("div",null,[(0,a._)("h5",null,(0,l.zw)(t.product.title),1),(0,a._)("p",null,(0,l.zw)(t.product.description),1)])])),_:2},1032,["to"])]),(0,a._)("td",_,[t.product.price===t.product.origin_price?((0,a.wg)(),(0,a.iD)("div",b,(0,l.zw)(t.price)+" 元 ",1)):((0,a.wg)(),(0,a.iD)("div",v,[(0,a._)("small",null,[(0,a._)("del",null,(0,l.zw)(t.product.origin_price)+" 元",1)]),(0,a._)("div",null,(0,l.zw)(t.product.price)+" 元",1)]))]),(0,a._)("td",null,[(0,a._)("div",f,[(0,a._)("button",{class:"btn btn-secondary",type:"button",onClick:e=>N.updateCartItem(t,-1)},"-",8,C),(0,a.wy)((0,a._)("input",{type:"number",onkeypress:"return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57",class:"form-control text-center","onUpdate:modelValue":e=>t.qty=e,onChange:e=>N.updateCartItem(t,0)},null,40,y),[[o.nr,t.qty,void 0,{number:!0}]]),(0,a._)("button",{class:"btn btn-secondary",type:"button",onClick:e=>N.updateCartItem(t,1)},"+",8,k)]),(0,a._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>N.removeCartItem(t.id),disabled:J.isLoadingItem===t.id}," 刪除 ",8,w)]),(0,a._)("td",x,(0,l.zw)(t.total),1)])))),128))]),(0,a._)("tfoot",null,[(0,a._)("tr",null,[$,(0,a._)("td",L,(0,l.zw)(J.cartData.total),1)]),(0,a._)("tr",null,[D,(0,a._)("td",I,[(0,a.Uk)((0,l.zw)(Math.floor(J.cartData.final_total))+" ",1),V,J.cartData.carts[0].coupon?((0,a.wg)(),(0,a.iD)("small",S,"(已套用「"+(0,l.zw)(J.cartData.carts[0].coupon.title)+"」優惠券："+(0,l.zw)(J.cartData.carts[0].coupon.code)+")",1)):(0,a.kq)("",!0)])])])]),(0,a._)("div",M,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=t=>J.couponCode=t),placeholder:"請輸入優惠碼",ref:"couponCode"},null,512),[[o.nr,J.couponCode]]),(0,a._)("div",W,[(0,a._)("button",{class:"btn btn-outline-secondary",type:"button",onClick:e[2]||(e[2]=(...t)=>N.addCouponCode&&N.addCouponCode(...t))}," 套用優惠碼 ")])])])),(0,a._)("div",q,[U,(0,a._)("div",z,[(0,a.Wm)(et,{ref:"form",class:"col-md-6",onSubmit:N.createOrder},{default:(0,a.w5)((({errors:t})=>[(0,a._)("div",O,[j,(0,a.Wm)(X,{id:"email",name:"email",type:"email",class:(0,l.C_)(["form-control",{"is-invalid":t["email"]}]),rules:"email|required",placeholder:"請輸入 Email",modelValue:J.form.user.email,"onUpdate:modelValue":e[3]||(e[3]=t=>J.form.user.email=t)},null,8,["class","modelValue"]),(0,a.Wm)(tt,{name:"email",class:"invalid-feedback"})]),(0,a._)("div",E,[P,(0,a.Wm)(X,{id:"name",name:"姓名",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":t["姓名"]}]),placeholder:"請輸入姓名",rules:"required",modelValue:J.form.user.name,"onUpdate:modelValue":e[4]||(e[4]=t=>J.form.user.name=t)},null,8,["class","modelValue"]),(0,a.Wm)(tt,{name:"姓名",class:"invalid-feedback"})]),(0,a._)("div",T,[Z,(0,a.Wm)(X,{id:"tel",name:"電話",type:"tel",class:(0,l.C_)(["form-control",{"is-invalid":t["電話"]}]),placeholder:"請輸入電話",rules:N.isPhone,modelValue:J.form.user.tel,"onUpdate:modelValue":e[5]||(e[5]=t=>J.form.user.tel=t)},null,8,["class","rules","modelValue"]),(0,a.Wm)(tt,{name:"電話",class:"invalid-feedback"})]),(0,a._)("div",F,[H,(0,a.Wm)(X,{id:"address",name:"地址",type:"text",class:(0,l.C_)(["form-control",{"is-invalid":t["地址"]}]),placeholder:"請輸入地址",rules:"required",modelValue:J.form.user.address,"onUpdate:modelValue":e[6]||(e[6]=t=>J.form.user.address=t)},null,8,["class","modelValue"]),(0,a.Wm)(tt,{name:"地址",class:"invalid-feedback"})]),(0,a._)("div",K,[Y,(0,a.wy)((0,a._)("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[7]||(e[7]=t=>J.form.message=t)},null,512),[[o.nr,J.form.message]])]),(0,a._)("div",A,[(0,a._)("button",{type:"submit",class:"btn btn-danger",disabled:Object.keys(t).length>0||0===J.cartData.carts.length}," 送出訂單 ",8,B)])])),_:1},8,["onSubmit"])])])])}var J=s(4902),N={data(){return{cartData:{carts:[]},products:[],product:{},couponCode:"",isLoading:!1,isLoadingItem:"",form:{user:{email:"",name:"",tel:"",address:""},message:""}}},methods:{getCart(){this.isLoading=!0,this.$http.get("https://vue3-course-api.hexschool.io/v2/api/yclu/cart").then((t=>{this.cartData=t.data.data,J.Z.emit("get-cart"),this.isLoading=!1})).catch((t=>{this.$httpMessageState(t.response,"錯誤訊息"),this.isLoading=!1}))},removeCartItem(t){this.isLoadingItem=t,this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/yclu/cart/${t}`).then((t=>{this.$httpMessageState(t,"移除購物車品項"),this.getCart(),this.isLoadingItem=""})).catch((t=>{this.$httpMessageState(t.response,"移除購物車品項"),this.isLoadingItem=""}))},updateCartItem(t,e){if(t.qty+e===0)return void this.removeCartItem(t.id);if(t.qty+e<1||t.qty%1!==0)return void this.emitter.emit("push-message",{style:"success",title:"錯誤訊息",content:"輸入數量錯誤"});const s={product_id:t.id,qty:t.qty+e};this.isLoadingItem=t.id,this.$http.put(`https://vue3-course-api.hexschool.io/v2/api/yclu/cart/${t.id}`,{data:s}).then((t=>{this.$httpMessageState(t,"更新購物車"),this.getCart(),this.isLoadingItem=""})).catch((t=>{this.$httpMessageState(t.response,"更新購物車"),this.isLoadingItem=""}))},clearCart(){this.isLoading=!0,setTimeout((()=>{this.isLoading=!1}),1e3),this.$http.delete("https://vue3-course-api.hexschool.io/v2/api/yclu/carts").then((t=>{this.$httpMessageState(t,"清空購物車"),this.getCart()})).catch((t=>{this.$httpMessageState(t.response,"清空購物車")}))},addCouponCode(){this.isLoading=!0;const t={code:this.couponCode};this.$http.post("https://vue3-course-api.hexschool.io/v2/api/yclu/coupon",{data:t}).then((t=>{this.$httpMessageState(t,"套用優惠券"),this.couponCode="",this.getCart(),this.isLoading=!1})).catch((t=>{this.$httpMessageState(t.response,"套用優惠券"),this.couponCode="",this.isLoading=!1}))},createOrder(){this.isLoading=!0,setTimeout((()=>{this.isLoading=!1}),1e3);const t={data:this.form};this.$http.post("https://vue3-course-api.hexschool.io/v2/api/yclu/order",t).then((t=>{this.$httpMessageState(t,"送出訂單"),this.$refs.form.resetForm(),this.form.message="",this.$router.push(`/checkout/${t.data.orderId}`)})).catch((t=>{this.$httpMessageState(t.response,"送出訂單")}))},isPhone(t){const e=/^(09)[0-9]{8}$/;return!!e.test(t)||"電話格式錯誤"}},mounted(){this.getCart()}},Q=s(3744);const R=(0,Q.Z)(N,[["render",G]]);var X=R}}]);
//# sourceMappingURL=732.6ab06956.js.map